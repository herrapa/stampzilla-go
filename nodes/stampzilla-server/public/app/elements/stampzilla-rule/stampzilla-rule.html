<link rel="import" href="../stampzilla-action/stampzilla-action-badge.html">
<link rel="import" href="../stampzilla-action/stampzilla-action-selector.html">
<link rel="import" href="../stampzilla-rule/stampzilla-condition.html">

<dom-module id="stampzilla-rule">
	<style is="custom-style">
		:host {
			@apply(--layout-vertical);
		}

		:host:hover {
			/*@apply(--shadow-elevation-6dp);*/
		}

		#title {
			color: #727272;
			font-size:20px;
			font-family: 'Roboto', 'Noto', sans-serif;
			@apply(--layout-horizontal);
		    @apply(--layout-center);
		}
	</style>
	<template>
		<paper-dialog entry-animation="fade-in-animation"
					  exit-animation="fade-out-animation"
					  id="dialog"
					  with-backdrop="true"
		>
			<div id="header" class="layout horizontal">
				<iron-icon icon="assignment"></iron-icon>
				<h2>[[data.name]]</h2>
			</div>
			<div class="layout vertical">
				<paper-input value="{{changed.name}}" label="Name">
			</div>
			<div class="layout vertical">
				<strong>Conditions</strong>
				<template is="dom-repeat" items="{{data.conditions}}" as="item" index-as="i">
					<stampzilla-condition data={{item}}></stampzilla-condition>
				</template>
			</div>
			<div class="layout vertical">
				<strong>Enter actions</strong>
				<stampzilla-action-selector rule="{{data.uuid}}" cancel={{data.enterCancelActions}} activate="{{data.enterActions}}"  actions={{actions}}></stampzilla-action-selector>

				<strong>Exit actions</strong>
				<stampzilla-action-selector rule="{{data.uuid}}" cancel={{data.exitCancelActions}} activate="{{data.exitActions}}"  actions={{actions}}></stampzilla-action-selector>
			</div>
		</paper-dialog>


		<div class="layout horizontal title">
			<paper-toggle-button checked$="[[data.enabled]]" disabled></paper-toggle-button>
			<span id="title" class="flex">
				<template is="dom-if" if="{{!data.active}}">
					{{data.name}}
				</template>
				<template is="dom-if" if="{{data.active}}">
					<span style="color:#090">{{data.name}}</span>
				</template>
			</span>
			<paper-icon-button icon="settings" id="settings" title="Click to open settings"></paper-icon-button>
		</div>

	</template>
	<script>
		(function () {
			Polymer({
				isText: false,
				is: 'stampzilla-rule',
				properties: {
					data: {
						type: Object,
						notify: true
					},
					rules: {
						type: Object,
						notify: true
					},
					actions: {
						type: Object,
						notify: true
					}
				},
				observers: [
				],
				listeners: {
        			'settings.click': 'openDialog',
				},
				ready: function() {
					this.changed = this.data;
				},
				openDialog: function() {
					this.$.dialog.open();
				},
				handleClick: function(e) {
					var pkg = {
						type: 'rules/run',
						data: {
							'uuid': e.target.uuid,
							'dir': 'enter'
						}
					};

					app.fire('ws-send', pkg);
				},
				handleClick2: function(e) {
					var pkg = {
						type: 'rules/run',
						data: {
							'uuid': e.target.uuid,
							'dir': 'exit'
						}
					};

					app.fire('ws-send', pkg);
				}
			});
		})();
	</script>

</dom-module>
