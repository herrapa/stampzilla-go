<link rel="import" href="../stampzilla-action/stampzilla-action-badge.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">

<dom-module id="stampzilla-schedule">
	<style is="custom-style">
		:host {
			@apply(--layout-vertical);
			@apply(--shadow-elevation-2dp);

			margin-bottom:10px;
			padding:1em;
			background: #fff;
		}

		:host:hover {
			@apply(--shadow-elevation-6dp);
		}

		#title {
			color: #727272;
			font-size:20px;
			font-family: 'Roboto', 'Noto', sans-serif;
			margin-bottom:10px;
			border-bottom: 1px solid rgba(0,0,0,0.22);
		}

		.title {
			margin-bottom:12px;
		}

		table {
			margin-left:12px;
		}

		.row .cell {
			padding: 5px;
			text-align:left;
		}

		.row .cell .flex {
			overflow-y:none;
		}
		.args {
			color: #666666;
			font-size:0.8em;
		}

		.m {
			padding:10px; 
			margin-bottom:-5px;
		}
	</style>
	<template>
		<paper-dialog entry-animation="fade-in-animation"
					  exit-animation="fade-out-animation"
					  id="dialog"
					  with-backdrop="true"
		>
			<div id="header" class="layout horizontal">
				<iron-icon icon="schedule"></iron-icon>
				<h2>[[data.name]]</h2>
			</div>
			<div class="layout vertical">
				When: <span>[[data.when]]</span>
			</div>
			<div class="layout vertical">
				<div class="m"><paper-radio-button checked="{{sunrise}}">Sunrise</paper-radio-button></div>
				<div class="m" style="margin-top:-15px"><paper-radio-button checked="{{sunset}}">Sunset</paper-radio-button></div>
				<div class="m layout vertical" style="background:#eee;">
					<paper-radio-button checked="{{cron}}">Specific time</paper-radio-button>
					<div class="layout horizontal" style="padding-left:27px;">

					</div>
					<div class="layout horizontal" style="padding-left:27px;">
						<div class="layout vertical">
							<div class="layout vertical">
								<strong>Minute</strong>
								<paper-input value="{{minutes}}" disabled="{{!cron}}"></paper-input>
							</div>
							<div class="layout vertical">
								<paper-radio-button checked="{{everyMinute}}" disabled="{{!cron}}">Every minute</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Even minutes</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Odd minutes</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Every 5 minutes</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Every 15 minutes</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Every 30 minutes</paper-radio-button>
							</div>
						</div>
						<div class="layout vertical">
							<strong>Hour</strong>
							<div class="layout vertical">
								<paper-input value="{{hours}}" disabled="{{!cron}}"></paper-input>
							</div>
							<div class="layout vertical">
								<paper-radio-button checked="{{everyHour}}" disabled="{{!cron}}">Every hour</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Even hours</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Odd hours</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Every 6 hours</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Every 12 hours</paper-radio-button>
							</div>
						</div>
						<div class="layout vertical">
							<strong>Day</strong>
							<div class="layout vertical">
								<paper-input disabled="{{!cron}}"></paper-input>
							</div>
							<div class="layout vertical">
								<paper-radio-button checked="{{everyDayInMonth}}" disabled="{{!cron}}">Every day</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Even days</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Odd days</paper-radio-button>
							</div>
						</div>
						<div class="layout vertical">
							<strong>Month</strong>
							<div class="layout vertical">
							</div>
							<div class="layout vertical">
								<paper-radio-button checked="{{everyMonth}}" disabled="{{!cron}}">All</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Odd</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Even</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Every quater year</paper-radio-button>
								<paper-radio-button disabled="{{!cron}}">Every half year</paper-radio-button>
								<paper-checkbox disabled="{{!cron}}">January</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">February</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">Mars</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">April</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">May</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">June</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">July</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">August</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">September</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">October</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">November</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">December</paper-checkbox>
							</div>
						</div>
						<div class="layout vertical">
							<strong>Weekday</strong>
							<div class="layout vertical">
							</div>
							<div class="layout vertical">
								<paper-radio-button checked="{{everyWeekday}}" disabled="{{!cron}}">All</paper-radio-button>
								<paper-checkbox disabled="{{!cron}}">Monday</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">Tuesday</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">Wednesday</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">Thursday</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">Friday</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">Saturday</paper-checkbox>
								<paper-checkbox disabled="{{!cron}}">Sunday</paper-checkbox>
							</div>
						</div>
					</div>
				</div>
			</div>
		</paper-dialog>

		<paper-shadow z="1"></paper-shadow>
		<div class="layout horizontal title">
			<div id="title"><paper-toggle-button checked disabled></paper-toggle-button></div>
			<div id="title" class="flex">{{data.name}}</div>
			<paper-icon-button icon="settings" id="settings" title="Click to open settings"></paper-icon-button>
		</div>
			<div class="horizontal layout">
				<div class="flex col">
					<div><span>[[_prettycron(data.when)]]</span> (next run: <span>[[_prettycronNext(data.when)]]</span>)</div>
				</div>

				<div class="col">
					<strong>Actions</strong>
					<template is="dom-repeat" items="{{data.actions}}" as="item" index-as="i">
						<div class="horizontal layout row">
							<stampzilla-action-badge uuid="[[item]]"></stampzilla-action-badge>
						</div>
					</template>
				</div>
			</div>
	</template>
	<script>
		(function () {
			Polymer({
				isText: false,
				is: 'stampzilla-schedule',
				properties: {
					data: {
						type: Object,
						notify: true
					},
					schedule: {
						type: Object,
						notify: true
					},


				},
				observers: [
				],
				listeners: {
        			'settings.click': 'openDialog',
				},

				ready: function() {
					this.read();
				},
				read: function() {
					schedule = later.parse.cron(this.data.when, true)['schedules'][0];
					//console.log(schedule);

					this.sunrise = this.data.when === "@sunrise";
					this.sunset = this.data.when === "@sunset";
					this.cron = !this.sunset && !this.sunrise;

					
					if ( this.cron ) {
						this.everySecond = schedule['s'] === undefined;
						this.everyMinute = schedule['m'] === undefined;
						this.everyHour = schedule['h'] === undefined;
						this.everyWeekday = schedule['d'] === undefined;
						this.everyDayInMonth = schedule['D'] === undefined;
						this.everyMonth = schedule['M'] === undefined;

						this.minutes = schedule['m'];
						this.hours = schedule['h'];
					}
				},

				openDialog: function() {
					this.$.dialog.open();
				},
				_prettycron: function(data) {
					switch(data) {
						case "@sunset":
							return "At sunset";
						case "@sunrise":
							return "At sunrise";
						default:
							return prettyCron.toString(data, true);
					}
				},
				_prettycronNext: function(data) {
					switch(data) {
						case "@sunset":
							return "-";
						case "@sunrise":
							return "-";
						default:
							return prettyCron.getNext(data, true);
					}
				}

			});
		})();
	</script>

</dom-module>
